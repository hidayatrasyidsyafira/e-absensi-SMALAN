<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Aplikasi Absensi SMAN 9 Lutra</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f6f9; }
    header, footer { background:#003366; color:white; padding:10px; display:flex; justify-content:space-between; align-items:center; }
    header img { height:50px; }
    footer { text-align:center; font-size:14px; }
    main { display:grid; grid-template-columns: 1fr 2fr 1fr; height:calc(100vh - 120px); }
    .clock { font-size:40px; text-align:center; margin-top:20px; }
    .form { text-align:center; padding:20px; }
    .form img { width:200px; height:200px; border-radius:10px; margin-bottom:10px; }
    .form input { font-size:18px; padding:5px; width:60%; text-align:center; }
    .list { padding:20px; overflow-y:auto; }
    .siswa { display:flex; align-items:center; background:white; margin-bottom:10px; padding:10px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
    .siswa img { width:50px; height:50px; border-radius:50%; margin-right:10px; }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <img src="logo_sma.png" alt="Logo SMA">
    <h3>Administrator</h3>
  </header>

  <!-- MAIN -->
  <main>
    <!-- JAM DIGITAL -->
    <div class="clock" id="clock"></div>

    <!-- FORM ABSENSI -->
    <div class="form">
      <img id="foto" src="default.png" alt="Foto Siswa">
      <div><strong id="nama">Nama Siswa</strong></div>
      <div><span id="nisn">NISN</span> | <span id="kelas">Kelas</span></div>
      <br>
      <input type="text" id="inputNisn" placeholder="Masukkan NISN" autofocus>
    </div>

    <!-- LIST ABSENSI -->
    <div class="list" id="listAbsensi"></div>
  </main>

  <!-- FOOTER -->
  <footer>
    Copy Right @ SMAN 9 Lutra
  </footer>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  // Jam digital realtime
  function updateClock() {
    const now = new Date();
    document.getElementById('clock').innerText =
      now.toLocaleTimeString('id-ID', {hour12:false});
  }
  setInterval(updateClock, 1000);
  updateClock();

  // Fokus otomatis ke input NISN
  document.getElementById('nisn-input').focus();

  // Ganti dengan URL Web App kamu
  const apiUrl = "https://script.google.com/macros/s/AKfycbzfzS190OdgNiz3PkQyKMba8XewaetAcQHBqT1RSvKCx8SXndcIZcoy-an7Jz56Da8UBw/exec";

  document.getElementById('nisn-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      const nisn = String(this.value).trim(); // pastikan string
      if (!nisn) return;

      console.log("üîé NISN dikirim:", nisn); // Debug cek nisn

      fetch(apiUrl + "?nisn=" + encodeURIComponent(nisn))
        .then(res => res.json())
        .then(data => {
          console.log("üì• Respon dari Apps Script:", data); // Debug cek respon

          if (data.status === "Berhasil Absen") {
            Swal.fire({
              title: "Absensi Berhasil",
              text: `${data.nama} - ${data.kelas}`,
              imageUrl: data.foto,
              timer: 3000,
              showConfirmButton: false
            });

            document.getElementById('student-photo').src = data.foto;
            document.getElementById('student-name').innerText = data.nama;
            document.getElementById('student-nisn').innerText = data.nisn;
            document.getElementById('student-class').innerText = data.kelas;

            // Tambah ke daftar kanan
            const li = document.createElement("li");
            li.innerHTML = `<img src="${data.foto}"><span>${data.nama} (${data.kelas})</span>`;
            document.getElementById('absen-list').prepend(li);
          } else {
            Swal.fire("Error", data.status, "error");
          }
          document.getElementById('nisn-input').value = "";
        })
        .catch(err => {
          console.error("‚ùå Error fetch:", err);
          Swal.fire("Error", "Gagal menghubungi server!", "error");
        });
    }
  });
</script>
</body>
</html>
